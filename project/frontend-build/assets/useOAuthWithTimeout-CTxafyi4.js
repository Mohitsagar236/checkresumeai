import{r as o,j as n}from"./react-vendor-GyENwBWe.js";import{R as I,P as N,C as p,T as b,D as O,O as w}from"./ui-components-C10pzA45.js";import{c as i,u as k}from"./heavy-pages-C8trrwvk.js";const C=I,R=N,T=o.forwardRef(({className:e,...t},a)=>n.jsx(w,{ref:a,className:i("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm transition-none",e),...t}));T.displayName=w.displayName;const D=o.forwardRef(({className:e,children:t,...a},r)=>n.jsxs(R,{children:[n.jsx(T,{}),"    ",n.jsx(p,{ref:r,className:i("fixed z-50 w-[90vw] max-w-[448px] min-h-[500px] border border-gray-200 bg-white p-6 shadow-lg rounded-lg dark:border-gray-800 dark:bg-gray-900","transition-none","stable-modal",e),style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"448px",maxWidth:"90vw",minHeight:"500px"},...a,children:t})]}));D.displayName=p.displayName;const j=({className:e,...t})=>n.jsx("div",{className:i("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});j.displayName="DialogHeader";const P=o.forwardRef(({className:e,...t},a)=>n.jsx(b,{ref:a,className:i("text-lg font-semibold leading-none tracking-tight",e),...t}));P.displayName=b.displayName;const $=o.forwardRef(({className:e,...t},a)=>n.jsx(O,{ref:a,className:i("text-sm text-gray-500 dark:text-gray-400",e),...t}));$.displayName=O.displayName;const E=o.forwardRef(({className:e,type:t,...a},r)=>n.jsx("input",{type:t,className:i("flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-brand-400",e),ref:r,...a}));E.displayName="Input";const y=3e4;function H(){const[e,t]=o.useState(null),[a,r]=o.useState(null),{signInWithOAuth:g}=k(),l=o.useRef(null);o.useEffect(()=>{if(e&&a)return l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{t(null),r(null)},45e3),()=>{l.current&&clearTimeout(l.current)}},[e,a]);const f=o.useRef(null);o.useEffect(()=>{const s=e||null,u=(s==null?void 0:s.toString())||"",m=f.current||"";u!==m&&(e?(sessionStorage.setItem("lastOAuthProvider",e),sessionStorage.setItem("lastOAuthStartTime",String(a))):(sessionStorage.removeItem("lastOAuthProvider"),sessionStorage.removeItem("lastOAuthStartTime")),f.current=u)},[e,a]);const A=o.useCallback(async(s,u)=>{if(e){console.log(`useOAuthWithTimeout: ${s} OAuth already in progress, ignoring`);return}console.log(`useOAuthWithTimeout: Starting ${s} OAuth authentication`);const m=Date.now();r(m),t(s);const S=new Promise((c,d)=>{const x=setTimeout(()=>{console.log(`useOAuthWithTimeout: ${s} OAuth timed out after ${y}ms`),d(new Error(`${s} sign-in is taking longer than expected. If you're not redirected soon, please try again.`))},y);return sessionStorage.setItem("oauthTimeoutId",String(x)),()=>{clearTimeout(x),sessionStorage.removeItem("oauthTimeoutId")}});try{throw console.log(`useOAuthWithTimeout: Initiating ${s} OAuth with timeout protection`),await Promise.race([g(s),S]),console.warn(`useOAuthWithTimeout: ${s} OAuth completed but no redirect occurred`),new Error(`${s} sign-in was initiated but no redirect occurred. Please try again or use email login.`)}catch(c){console.error(`useOAuthWithTimeout: ${s} OAuth error:`,c);const d=c instanceof Error?c.message:`Failed to sign in with ${s}. Please check your connection and try again.`;u(d),t(null),r(null)}},[g,e]),h=o.useRef(()=>{t(null),r(null)});return o.useEffect(()=>{h.current=()=>{t(null),r(null)}},[]),{oauthLoading:e,handleOAuthSignIn:A,clearOAuthLoading:h.current}}export{C as D,E as I,D as a,j as b,P as c,$ as d,H as u};
