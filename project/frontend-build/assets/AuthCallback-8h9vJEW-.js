import{b as y,r as b,j as r}from"./react-vendor-GyENwBWe.js";import{L as R,s as S}from"./heavy-pages-C8trrwvk.js";import"./vendor-x74MHN4I.js";import"./api-auth-dsn4brwG.js";import"./utilities-CaqBGVfY.js";import"./pdfjs-Cev1TANf.js";import"./ui-components-C10pzA45.js";const v={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"https://checkresumeai.vercel.app/api",VITE_ENABLE_PREMIUM_FEATURES:"true",VITE_ENABLE_REAL_TIME_ANALYSIS:"true",VITE_GROQ_API_KEY:"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",VITE_OPENAI_API_KEY:"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",VITE_RAZORPAY_KEY_ID:"rzp_test_LOXRGg0tuOTABB",VITE_RAZORPAY_TEST_MODE:"true",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdibWhmem9hbm1uYXlqdmF4ZGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzOTAzNzAsImV4cCI6MjA2NDk2NjM3MH0.ShE9Pwab0gfWLvmzYAGqr5ejtDemWoN8y3g4HSyhVM4",VITE_SUPABASE_URL:"https://gbmhfzoanmnayjvaxdfu.supabase.co",VITE_TOGETHER_API_KEY:"f6b93dd221b9b1cfabb27ac0a54c5de0fe3d4a9342d9892c462760e8a0555946",VITE_USE_MOCK_API:"false"};function P(e,c){const p=e.get("error")||c.get("error"),f=e.get("error_code")||c.get("error_code"),l=e.get("error_description")||c.get("error_description"),m={error:p,errorCode:f,errorDescription:l,possibleCauses:[],solutions:[]};f==="bad_oauth_state"&&(m.possibleCauses=["The OAuth state parameter from the redirect does not match the expected state","The user may have started OAuth on one port (e.g., 5173) but was redirected to another (e.g., 3000)","Potential CSRF attack (though unlikely)","OAuth process took too long and state was cleared from storage","User has two browser windows open with different OAuth flows"],m.solutions=["Ensure the VITE_REDIRECT_URL in .env matches the actual port your app is running on","Explicitly set the port when starting the development server (use the run-auth-fixed-port.js script)","Clear browser storage and try again","Make sure your OAuth provider settings in Supabase Dashboard have the correct redirect URL"]);const d={localStorage:{},sessionStorage:{},supabaseStateMismatch:!1};try{for(let i=0;i<localStorage.length;i++){const t=localStorage.key(i);t&&(t.includes("supabase")||t.includes("oauth")||t.includes("auth"))&&(d.localStorage[t]=localStorage.getItem(t))}for(let i=0;i<sessionStorage.length;i++){const t=sessionStorage.key(i);t&&(t.includes("supabase")||t.includes("oauth")||t.includes("auth"))&&(d.sessionStorage[t]=sessionStorage.getItem(t))}const u=localStorage.getItem("supabase-auth-state"),o=sessionStorage.getItem("supabase-auth-state"),n=e.get("state")||c.get("state");u&&n&&u!==n&&(d.supabaseStateMismatch=!0,d.stateDiagnosis={expectedState:u,sessionState:o,returnedState:n,match:u===n||o===n}),m.debugInfo=d}catch(u){m.storageError=u.message}return m}function O(){return window.location.port||(window.location.protocol==="https:"?"443":"80")}function U(){console.log("=== OAuth Environment Info ==="),console.log("Current URL:",window.location.href),console.log("Port:",O()),console.log("Hostname:",window.location.hostname),console.log("Protocol:",window.location.protocol),console.log("User Agent:",navigator.userAgent),console.log("Environment Variables:"),["VITE_REDIRECT_URL","VITE_SUPABASE_URL","VITE_DEBUG_OAUTH"].forEach(c=>{try{console.log(`- ${c}: ${v[c]||"not set"}`)}catch{console.log(`- ${c}: error reading`)}})}function B(){const e=y(),[c,p]=b.useState(!0),[f,l]=b.useState(null);return console.log("⭐ Auth Callback Page Loaded"),console.log("🔑 Stored state:",localStorage.getItem("supabase-auth-state")),console.log("📝 Session state:",sessionStorage.getItem("supabase-auth-state")),console.log("⏱️ OAuth initiated at:",sessionStorage.getItem("oauth-initiated-at")),b.useEffect(()=>{(async()=>{var d,u;try{p(!0),l(null),console.log("🔄 Processing authentication callback..."),console.log("🌐 Current URL:",window.location.href),console.log("🏠 Origin:",window.location.origin),U();const o=new URLSearchParams(window.location.search),n=new URLSearchParams(window.location.hash.substring(1));console.log("📝 URL Parameters:",Object.fromEntries(o.entries())),console.log("📝 Hash Parameters:",Object.fromEntries(n.entries()));const i=n.get("access_token")||o.get("access_token"),t=n.get("refresh_token")||o.get("refresh_token"),E=n.get("error_description")||o.get("error_description")||n.get("error")||o.get("error"),w=n.get("provider")||o.get("provider");if(console.log("🔑 Access token present:",!!i),console.log("🔄 Refresh token present:",!!t),console.log("🔌 Provider:",w||"unknown"),console.log("❌ Error description:",E),E){console.error("❌ OAuth error:",E);const s=P(o,n);console.log("🔍 OAuth Error Diagnosis:",s),o.get("error_code")==="bad_oauth_state"?l(`Authentication failed: OAuth state mismatch. This might be due to a port mismatch between 3000 and ${window.location.port}. Try using the run-auth-fixed-port.js script.`):l(`Authentication failed: ${E}`),setTimeout(()=>e("/login"),5e3);return}const h=localStorage.getItem("supabase-auth-state"),A=sessionStorage.getItem("supabase-auth-state"),g=n.get("state")||o.get("state"),k=window.location.port||"3000";if(console.log("🔒 Auth State Check:",{expectedState:h,sessionState:A,returnedState:g,currentPort:k,currentUrl:window.location.href}),g)if(h===g||A===g)console.log("✅ State validation passed");else if(h&&g&&h!==g){console.warn("⚠️ State mismatch detected"),console.log("Expected state:",h),console.log("Session state:",A),console.log("Returned state:",g);const s=/_port(\d+)$/,a=h==null?void 0:h.match(s),_=g==null?void 0:g.match(s);a&&_&&(console.log(`Expected port: ${a[1]}, Returned port: ${_[1]}`),a[1]!==_[1]&&console.warn(`Port mismatch detected: expected ${a[1]} but got ${_[1]}`)),localStorage.removeItem("supabase-auth-state"),sessionStorage.removeItem("supabase-auth-state"),console.log("Proceeding with authentication despite state mismatch (for usability)")}else console.log("No state comparison possible - missing expected state");else console.log("No state returned from OAuth provider");localStorage.removeItem("supabase-auth-state"),sessionStorage.removeItem("supabase-auth-state");const I=o.get("code");if(I){console.log("🔑 Authorization code present, exchanging for tokens...");const{data:s,error:a}=await S.auth.exchangeCodeForSession(I);if(a){console.error("❌ Code exchange error:",a),l(`Authentication failed: ${a.message}`),setTimeout(()=>e("/login"),3e3);return}if(s.session){console.log("✅ Code exchange successful, session established"),console.log("👤 User:",(d=s.session.user)==null?void 0:d.email),window.history.replaceState({},document.title,window.location.pathname),e("/");return}}if(i){console.log("🔐 Setting session with OAuth tokens...");const{data:s,error:a}=await S.auth.setSession({access_token:i,refresh_token:t||""});if(a){console.error("❌ Session setting error:",a),l(`Authentication failed: ${a.message}`),setTimeout(()=>e("/login"),3e3);return}if(s.session){console.log("✅ Authentication successful, session established"),console.log("👤 User:",(u=s.session.user)==null?void 0:u.email),window.history.replaceState({},document.title,window.location.pathname),e("/");return}}console.log("📝 Attempting to handle redirect result...");try{const{error:s}=await S.auth.getSession();s?console.warn("⚠️ Redirect handling produced an error:",s):console.log("✅ Auth state updated successfully")}catch(s){console.error("❌ Error handling redirect:",s)}const{data:{session:T},error:x}=await S.auth.getSession();if(x){console.error("❌ Session verification error:",x),l("Session verification failed."),setTimeout(()=>e("/login"),3e3);return}T?(console.log("Existing session found, redirecting to home"),e("/")):(console.log("No valid session found"),l("No valid session found. Please sign in again."),setTimeout(()=>e("/login"),3e3))}catch(o){console.error("Unexpected error in auth callback:",o),l("An unexpected authentication error occurred."),setTimeout(()=>e("/login"),3e3)}finally{p(!1)}})()},[e]),r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:r.jsx("div",{className:"text-center",children:c?r.jsxs(r.Fragment,{children:[r.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-4",children:"Processing authentication..."}),r.jsx(R,{})]}):f?r.jsxs(r.Fragment,{children:[r.jsx("h2",{className:"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4",children:"Authentication Error"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:f}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Redirecting to login page..."})]}):r.jsxs(r.Fragment,{children:[r.jsx("h2",{className:"text-2xl font-semibold text-green-600 dark:text-green-400 mb-4",children:"Authentication Successful"}),"            ",r.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Redirecting to home page..."})]})})})}export{B as default};
